oauth2设计

# 本设计实现

- 认证中心的前后端分离
- 客户端的前后端分离 客户端可以不需要登录界面，完全采用认证中心的登录界面

# oauth2系统自带5种认证类型

- 其中只有验证码和简化两种类型支持全流程。 即：可以让用户确权。
- 其余的没有用户确权界面
- 而简化模式与授权码模式相比，认证完成后客户端直接在地址中得到access_token， 不像授权码模式还要根据授权码再到/oauth/token请求访问令牌。
  但是简化模式返回没有刷新令牌，且不充许到/oauth/token请求令牌，因为/oauth/token不支持简化模式请求。

# 扩展授权类型

- 示例sms_code为扩展类型
- 扩展类型的局限
* 扩展类型只支持向/oauth/token请求令牌，不走认证流程，即不能访问地址： 
/oauth/authorize，/oauth/authorize在AuthorizationEndpoint实现，
AuthorizationEndpoint是认证的所有入口，只支持response_type=token|code，
如果扩展类型认证请求指定了response_type=token则默认走简化类型，根本不走扩展的类型，
如果带不有response_type参数，则报错，因为认证接口仅支持response_type=token和code
* 扩展类型类似于默认了用户确权，因此没有用户确权界面弹出。
* 其类似于系统自带的密码授权类型，因此流程与授权码模式并不统一 
* 扩展类似被改造为类似于不走用户确权步骤的简化模式，区别是它有刷新令牌，可随时访问/oauth/token地址

# 如何统一
- 从上面看到，如果采用扩展类型或简化类型都与授权码流程不一致。
- 如果采用扩展授权类型来扩展登录的模式，则会造成流程的不统一
- 如果采用扩展授权码类型扩展，像手机验证码类型和图片验证码类型都有验证码，再传一个授权码显示多余，因此不适合去扩展授权码类型
- 因此，大的方向是根据需要先选择认证流程，然后再选择认证流程支持的登录方式。认证流程可分为：
  * 标准流程，授权码模式为全流程，以授权码认证类型作为标准流程
  * 简化流程，即用户登录后在地址中得到访问令牌（比全流程少一个根据授权码再去取）
  * 用户信任流程，即无用户授权界面的流程，如系统的3个认证类型，自己扩展的授权类型均在此列
  * 自定义登录界面流程，用户定制自已的登录界面直接该问认证中心的/oauth/token取令牌。
  这种方式适合于扩展授权类型、系统的3个授权类型
### 可扩展的授权类型有
  - 邮箱登录
    - 邮箱验证码
    - 手机登录
    - 手机验证码
    - 图片验证码
    - openid
    - 第三方
### 认证中心提供第三方自定义登录界面
  - 提供给第三方sdk来通过RestFul获取访问令牌和刷新令牌，以支持其自定义登录。但自定义登录不走认证流程。